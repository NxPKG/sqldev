
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="SQLDev, SQL databases in Python, designed for simplicity, compatibility, and robustness.">
      
      
      
        <link rel="canonical" href="https://sqldev.khulnasoft.com/tutorial/readyapi/tests/">
      
      
        <link rel="prev" href="../relationships/">
      
      
        <link rel="next" href="../../../advanced/">
      
      
      <link rel="icon" href="../../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>Test Applications with ReadyAPI and SQLDev - SQLDev</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/termynal.css">
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-J8HVTT936W"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-J8HVTT936W",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-J8HVTT936W",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#test-applications-with-readyapi-and-sqldev" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="SQLDev" class="md-header__button md-logo" aria-label="SQLDev" data-md-component="logo">
      
  <img src="../../../img/icon-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SQLDev
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Test Applications with ReadyAPI and SQLDev
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/khulnasoft/sqldev" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    khulnasoft/sqldev
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="SQLDev" class="md-nav__button md-logo" aria-label="SQLDev" data-md-component="logo">
      
  <img src="../../../img/icon-white.svg" alt="logo">

    </a>
    SQLDev
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/khulnasoft/sqldev" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    khulnasoft/sqldev
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLDev
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Features
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../databases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro to Databases
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../db-to-code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database to Code (ORMs)
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tutorial - User Guide
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tutorial - User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../create-db-and-table-with-db-browser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a Table with SQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../create-db-and-table/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a Table with SQLDev - Use the Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../insert/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create Rows - Use the Session - INSERT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automatic-id-none-refresh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automatic IDs, None Defaults, and Refreshing Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../select/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Read Data - SELECT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../where/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Filter Data - WHERE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../indexes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Indexes - Optimize Queries
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../one/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Read One Row
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../limit-and-offset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Read a Range of Data - LIMIT and OFFSET
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update Data - UPDATE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../delete/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delete Data - DELETE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_13" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../connect/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Connect Tables - JOIN
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_13" id="__nav_5_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_13">
            <span class="md-nav__icon md-icon"></span>
            Connect Tables - JOIN
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../connect/create-connected-tables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create Connected Tables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../connect/create-connected-rows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create and Connect Rows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../connect/read-connected-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Read Connected Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../connect/update-data-connections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update Data Connections
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../connect/remove-data-connections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remove Data Connections
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_14" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../relationship-attributes/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Relationship Attributes
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_14" id="__nav_5_14_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14">
            <span class="md-nav__icon md-icon"></span>
            Relationship Attributes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../relationship-attributes/define-relationships-attributes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Define Relationships Attributes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../relationship-attributes/create-and-update-relationships/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create and Update Relationships
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../relationship-attributes/read-relationships/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Read Relationships
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../relationship-attributes/remove-relationships/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remove Relationships
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../relationship-attributes/back-populates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relationship back_populates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../relationship-attributes/type-annotation-strings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Type annotation strings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_15" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../many-to-many/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Many to Many
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_15" id="__nav_5_15_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_15">
            <span class="md-nav__icon md-icon"></span>
            Many to Many
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../many-to-many/create-models-with-link/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create Models with a Many-to-Many Link
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../many-to-many/create-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create Data with Many-to-Many Relationships
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../many-to-many/update-remove-relationships/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update and Remove Many-to-Many Relationships
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../many-to-many/link-with-extra-fields/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Link Model with Extra Fields
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Structure and Multiple Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_17" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ReadyAPI and Pydantic
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_17" id="__nav_5_17_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_17_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_17">
            <span class="md-nav__icon md-icon"></span>
            ReadyAPI and Pydantic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../simple-hero-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simple Hero API with ReadyAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../response-model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReadyAPI Response Model with SQLDev
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiple-models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple Models with ReadyAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../read-one/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Read One Model with ReadyAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../limit-and-offset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Read Heroes with Limit and Offset with ReadyAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update Data with ReadyAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../update-extra-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update with Extra Data (Hashed Passwords) with ReadyAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../delete/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delete Data with ReadyAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../session-with-dependency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session with ReadyAPI Dependency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../teams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReadyAPI Path Operations for Teams - Other Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../relationships/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Models with Relationships in ReadyAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Test Applications with ReadyAPI and SQLDev
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Test Applications with ReadyAPI and SQLDev
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#readyapi-application" class="md-nav__link">
    <span class="md-ellipsis">
      ReadyAPI Application
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-structure" class="md-nav__link">
    <span class="md-ellipsis">
      File Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-readyapi-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Testing ReadyAPI Applications
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-tests-code" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Tests Code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-database" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#override-a-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Override a Dependency
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-engine-and-session-for-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Engine and Session for Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create the Engine and Session for Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-table-models" class="md-nav__link">
    <span class="md-ellipsis">
      Import Table Models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-database" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-the-in-memory-database" class="md-nav__link">
    <span class="md-ellipsis">
      Configure the In-Memory Database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#boilerplate-code" class="md-nav__link">
    <span class="md-ellipsis">
      Boilerplate Code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytest-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Pytest Fixtures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-fixture" class="md-nav__link">
    <span class="md-ellipsis">
      Client Fixture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-more-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Add More Tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-two-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Why Two Fixtures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-the-rest-of-the-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Add the Rest of the Tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-the-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Run the Tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recap" class="md-nav__link">
    <span class="md-ellipsis">
      Recap
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../advanced/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Advanced User Guide
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Advanced User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/decimal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decimal Numbers
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../alternatives/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Alternatives, Inspiration and Comparisons
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../help/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Help SQLDev - Get Help
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release Notes
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#readyapi-application" class="md-nav__link">
    <span class="md-ellipsis">
      ReadyAPI Application
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-structure" class="md-nav__link">
    <span class="md-ellipsis">
      File Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-readyapi-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Testing ReadyAPI Applications
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-tests-code" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Tests Code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-database" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#override-a-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Override a Dependency
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-engine-and-session-for-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Engine and Session for Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create the Engine and Session for Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-table-models" class="md-nav__link">
    <span class="md-ellipsis">
      Import Table Models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-database" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-the-in-memory-database" class="md-nav__link">
    <span class="md-ellipsis">
      Configure the In-Memory Database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#boilerplate-code" class="md-nav__link">
    <span class="md-ellipsis">
      Boilerplate Code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytest-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Pytest Fixtures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-fixture" class="md-nav__link">
    <span class="md-ellipsis">
      Client Fixture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-more-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Add More Tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-two-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Why Two Fixtures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-the-rest-of-the-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Add the Rest of the Tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-the-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Run the Tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recap" class="md-nav__link">
    <span class="md-ellipsis">
      Recap
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="test-applications-with-readyapi-and-sqldev">Test Applications with ReadyAPI and SQLDev<a class="headerlink" href="#test-applications-with-readyapi-and-sqldev" title="Permanent link">&para;</a></h1>
<p>To finish this group of chapters about <strong>ReadyAPI</strong> with <strong>SQLDev</strong>, let's now learn how to implement automated tests for an application using ReadyAPI with SQLDev. ✅</p>
<p>Including the tips and tricks. 🎁</p>
<h2 id="readyapi-application">ReadyAPI Application<a class="headerlink" href="#readyapi-application" title="Permanent link">&para;</a></h2>
<p>Let's work with one of the <strong>simpler</strong> ReadyAPI applications we built in the previous chapters.</p>
<p>All the same <strong>concepts</strong>, <strong>tips</strong> and <strong>tricks</strong> will apply to more complex applications as well.</p>
<p>We will use the application with the hero models, but without team models, and we will use the dependency to get a <strong>session</strong>.</p>
<p>Now we will see how useful it is to have this session dependency. ✨</p>
<details>
<summary>👀 Full file preview</summary>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">readyapi</span> <span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">Query</span><span class="p">,</span> <span class="n">ReadyAPI</span>
<span class="kn">from</span> <span class="nn">sqldev</span> <span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">Session</span><span class="p">,</span> <span class="n">SQLDev</span><span class="p">,</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">select</span>


<span class="k">class</span> <span class="nc">HeroBase</span><span class="p">(</span><span class="n">SQLDev</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">secret_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">age</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Hero</span><span class="p">(</span><span class="n">HeroBase</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">HeroCreate</span><span class="p">(</span><span class="n">HeroBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">HeroPublic</span><span class="p">(</span><span class="n">HeroBase</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">class</span> <span class="nc">HeroUpdate</span><span class="p">(</span><span class="n">SQLDev</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">secret_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">age</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="n">sqlite_file_name</span> <span class="o">=</span> <span class="s2">&quot;database.db&quot;</span>
<span class="n">sqlite_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sqlite:///</span><span class="si">{</span><span class="n">sqlite_file_name</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">connect_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;check_same_thread&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">sqlite_url</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">connect_args</span><span class="o">=</span><span class="n">connect_args</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">create_db_and_tables</span><span class="p">():</span>
    <span class="n">SQLDev</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_session</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">ReadyAPI</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;startup&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">on_startup</span><span class="p">():</span>
    <span class="n">create_db_and_tables</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">HeroPublic</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_hero</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span> <span class="n">hero</span><span class="p">:</span> <span class="n">HeroCreate</span><span class="p">):</span>
    <span class="n">db_hero</span> <span class="o">=</span> <span class="n">Hero</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">hero</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">db_hero</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">session</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">db_hero</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db_hero</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">HeroPublic</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">read_heroes</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span>
    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
<span class="p">):</span>
    <span class="n">heroes</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Hero</span><span class="p">)</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">heroes</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/heroes/</span><span class="si">{hero_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">HeroPublic</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_hero</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span> <span class="n">hero_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">hero</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Hero</span><span class="p">,</span> <span class="n">hero_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">hero</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Hero not found&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hero</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/heroes/</span><span class="si">{hero_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">HeroPublic</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">update_hero</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span> <span class="n">hero_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">hero</span><span class="p">:</span> <span class="n">HeroUpdate</span>
<span class="p">):</span>
    <span class="n">db_hero</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Hero</span><span class="p">,</span> <span class="n">hero_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">db_hero</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Hero not found&quot;</span><span class="p">)</span>
    <span class="n">hero_data</span> <span class="o">=</span> <span class="n">hero</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">hero_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">db_hero</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">db_hero</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">session</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">db_hero</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db_hero</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/heroes/</span><span class="si">{hero_id}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">delete_hero</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span> <span class="n">hero_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">hero</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Hero</span><span class="p">,</span> <span class="n">hero_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">hero</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Hero not found&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">hero</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</code></pre></div>
</details>
<h2 id="file-structure">File Structure<a class="headerlink" href="#file-structure" title="Permanent link">&para;</a></h2>
<p>Now we will have a Python project with multiple files, one file <code>main.py</code> with all the application, and one file <code>test_main.py</code> with the tests, with the same ideas from <a class="internal-link" href="../../code-structure/" target="_blank">Code Structure and Multiple Files</a>.</p>
<p>The file structure is:</p>
<div class="highlight"><pre><span></span><code>.
├── project
    ├── __init__.py
    ├── main.py
    └── test_main.py
</code></pre></div>
<h2 id="testing-readyapi-applications">Testing ReadyAPI Applications<a class="headerlink" href="#testing-readyapi-applications" title="Permanent link">&para;</a></h2>
<p>If you haven't done testing in ReadyAPI applications, first check the <a href="https://readyapi.khulnasoft.com/tutorial/testing/" class="external-link" target="_blank">ReadyAPI docs about Testing</a>.</p>
<p>Then, we can continue here, the first step is to install the dependencies, <code>requests</code> and <code>pytest</code>.</p>
<p>Make sure you do it in the same <a class="internal-link" href="../../#create-a-python-virtual-environment" target="_blank">Python environment</a>.</p>
<div class="termy">

<div class="highlight"><pre><span></span><code><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>requests<span class="w"> </span>pytest

<span class="go">---&gt; 100%</span>
</code></pre></div>

</div>

<h2 id="basic-tests-code">Basic Tests Code<a class="headerlink" href="#basic-tests-code" title="Permanent link">&para;</a></h2>
<p>Let's start with a simple test, with just the basic test code we need the check that the <strong>ReadyAPI</strong> application is creating a new hero correctly.</p>
<div class="annotate highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">readyapi.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span> <span class="nn">sqldev</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">SQLDev</span><span class="p">,</span> <span class="n">create_engine</span>

<span class="kn">from</span> <span class="nn">.main</span> <span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">get_session</span>  <span class="c1"># (1)!</span>


<span class="k">def</span> <span class="nf">test_create_hero</span><span class="p">():</span>
        <span class="c1"># Some code here omitted, we will see it later 👈</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>  <span class="c1"># (2)!</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>  <span class="c1"># (3)!</span>
            <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Nx Pkg&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># Some code here omitted, we will see it later 👈</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>  <span class="c1"># (4)!</span>

        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>  <span class="c1"># (5)!</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpond&quot;</span>  <span class="c1"># (6)!</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>  <span class="c1"># (7)!</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>  <span class="c1"># (8)!</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># (9)!</span>

<span class="c1"># Code below omitted 👇</span>
</code></pre></div>
<ol>
<li>
<p>Import the <code>app</code> from the the <code>main</code> module.</p>
</li>
<li>
<p>We create a <code>TestClient</code> for the ReadyAPI <code>app</code> and put it in the variable <code>client</code>.</p>
</li>
<li>
<p>Then we use use this <code>client</code> to <strong>talk to the API</strong> and send a <code>POST</code> HTTP operation, creating a new hero.</p>
</li>
<li>
<p>Then we get the <strong>JSON data</strong> from the response and put it in the variable <code>data</code>.</p>
</li>
<li>
<p>Next we start testing the results with <code>assert</code> statements, we check that the status code of the response is <code>200</code>.</p>
</li>
<li>
<p>We check that the <code>name</code> of the hero created is <code>"Deadpond"</code>.</p>
</li>
<li>
<p>We check that the <code>secret_name</code> of the hero created is <code>"Nx Pkg"</code>.</p>
</li>
<li>
<p>We check that the <code>age</code> of the hero created is <code>None</code>, because we didn't send an age.</p>
</li>
<li>
<p>We check that the hero created has an <code>id</code> created by the database, so it's not <code>None</code>.</p>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Check out the number bubbles to see what is done by each line of code.</p>
</div>
<p>That's the <strong>core</strong> of the code we need for all the tests later.</p>
<p>But now, we need to deal with a bit of logistics and details we are not paying attention to just yet. 🤓</p>
<h2 id="testing-database">Testing Database<a class="headerlink" href="#testing-database" title="Permanent link">&para;</a></h2>
<p>This test looks fine, but there's a problem.</p>
<p>If we run it, it will use the same <strong>production database</strong> that we are using to store our very important <strong>heroes</strong>, and we will end up adding unnecessary data to it, or even worse, in future tests we could end up removing production data.</p>
<p>So, we should use an independent <strong>testing database</strong>, just for the tests.</p>
<p>To do this, we need to change the URL used for the database.</p>
<p>But when the code for the API is executed, it gets a <strong>session</strong> that is already connected to an <strong>engine</strong>, and the <strong>engine</strong> is already using a specific database URL.</p>
<p>Even if we import the variable from the <code>main</code> module and change its value just for the tests, by that point the <strong>engine</strong> is already created with the original value.</p>
<p>But all our API <em>path operations</em> get the <em>session</em> using a ReadyAPI <strong>dependency</strong>, and we can override dependencies in tests.</p>
<p>Here's where dependencies start to help a lot.</p>
<h2 id="override-a-dependency">Override a Dependency<a class="headerlink" href="#override-a-dependency" title="Permanent link">&para;</a></h2>
<p>Let's override the <code>get_session()</code> dependency for the tests.</p>
<p>This dependency is used by all the <em>path operations</em> to get the <strong>SQLDev</strong> session object.</p>
<p>We will override it to use a different <strong>session</strong> object just for the tests.</p>
<p>That way we protect the production database and we have better control of the data we are testing.</p>
<div class="annotate highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">readyapi.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span> <span class="nn">sqldev</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">SQLDev</span><span class="p">,</span> <span class="n">create_engine</span>

<span class="hll"><span class="kn">from</span> <span class="nn">.main</span> <span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">get_session</span>  <span class="c1"># (1)!</span>
</span>

<span class="k">def</span> <span class="nf">test_create_hero</span><span class="p">():</span>
        <span class="c1"># Some code here omitted, we will see it later 👈</span>
<span class="hll">        <span class="k">def</span> <span class="nf">get_session_override</span><span class="p">():</span>  <span class="c1"># (2)!</span>
</span><span class="hll">            <span class="k">return</span> <span class="n">session</span>  <span class="c1"># (3)!</span>
</span>
<span class="hll">        <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="p">[</span><span class="n">get_session</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_session_override</span>  <span class="c1"># (4)!</span>
</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Nx Pkg&quot;</span><span class="p">}</span>
        <span class="p">)</span>
<span class="hll">        <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># (5)!</span>
</span>        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpond&quot;</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="c1"># Code below omitted 👇</span>
</code></pre></div>
<ol>
<li>
<p>Import the <code>get_session</code> dependency from the the <code>main</code> module.</p>
</li>
<li>
<p>Define the new function that will be the new <strong>dependency override</strong>.</p>
</li>
<li>
<p>This function will return a different <strong>session</strong> than the one that would be returned by the original <code>get_session</code> function.</p>
<p>We haven't seen how this new <strong>session</strong> object is created yet, but the point is that this is a different session than the original one from the app.</p>
<p>This session is attached to a different <strong>engine</strong>, and that different <strong>engine</strong> uses a different URL, for a database just for testing.</p>
<p>We haven't defined that new <strong>URL</strong> nor the new <strong>engine</strong> yet, but here we already see the that this object <code>session</code> will override the one returned by the original dependency  <code>get_session()</code>.</p>
</li>
<li>
<p>Then, the ReadyAPI <code>app</code> object has an attribute <code>app.dependency_overrides</code>.</p>
<p>This attribute is a dictionary, and we can put dependency overrides in it by passing, as the <strong>key</strong>, the <strong>original dependency function</strong>, and as the <strong>value</strong>, the <strong>new overriding dependency function</strong>.</p>
<p>So, here we are telling the ReadyAPI app to use <code>get_session_override</code> instead of <code>get_session</code> in all the places in the code that depend on <code>get_session</code>, that is, all the parameters with something like:</p>
<div class="highlight"><pre><span></span><code><span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>After we are done with the dependency override, we can restore the application back to normal, by removing all the values in this dictionary <code>app.dependency_overrides</code>.</p>
<p>This way whenever a <em>path operation function</em> needs the dependency ReadyAPI will use the original one instead of the override.</p>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Check out the number bubbles to see what is done by each line of code.</p>
</div>
<h2 id="create-the-engine-and-session-for-testing">Create the Engine and Session for Testing<a class="headerlink" href="#create-the-engine-and-session-for-testing" title="Permanent link">&para;</a></h2>
<p>Now let's create that <strong>session</strong> object that will be used during testing.</p>
<p>It will use its own <strong>engine</strong>, and this new engine will use a new URL for the testing database:</p>
<div class="highlight"><pre><span></span><code>sqlite:///testing.db
</code></pre></div>
<p>So, the testing database will be in the file <code>testing.db</code>.</p>
<div class="annotate highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">readyapi.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span> <span class="nn">sqldev</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">SQLDev</span><span class="p">,</span> <span class="n">create_engine</span>

<span class="hll"><span class="kn">from</span> <span class="nn">.main</span> <span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">get_session</span>  <span class="c1"># (1)!</span>
</span>

<span class="k">def</span> <span class="nf">test_create_hero</span><span class="p">():</span>
<span class="hll">    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>  <span class="c1"># (2)!</span>
</span><span class="hll">        <span class="s2">&quot;sqlite:///testing.db&quot;</span><span class="p">,</span> <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;check_same_thread&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><span class="hll">    <span class="p">)</span>
</span><span class="hll">    <span class="n">SQLDev</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># (3)!</span>
</span>
<span class="hll">    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>  <span class="c1"># (4)!</span>
</span>
        <span class="k">def</span> <span class="nf">get_session_override</span><span class="p">():</span>
<span class="hll">            <span class="k">return</span> <span class="n">session</span>  <span class="c1"># (5)!</span>
</span>
        <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="p">[</span><span class="n">get_session</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_session_override</span>  <span class="c1"># (4)!</span>

        <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Nx Pkg&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpond&quot;</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="hll">    <span class="c1"># (6)!</span>
</span></code></pre></div>
<ol>
<li>
<p>Here's a subtle thing to notice.</p>
<p>Remember that <a class="internal-link" href="../../create-db-and-table/#sqldev-metadata-order-matters" target="_blank">Order Matters</a> and we need to make sure all the <strong>SQLDev</strong> models are already defined and <strong>imported</strong> before calling <code>.create_all()</code>.</p>
<p>IN this line, by importing something, <em>anything</em>, from <code>.main</code>, the code in <code>.main</code> will be executed, including the definition of the <strong>table models</strong>, and that will automatically register them in <code>SQLDev.metadata</code>.</p>
</li>
<li>
<p>Here we create a new <strong>engine</strong>, completely different from the one in <code>main.py</code>.</p>
<p>This is the engine we will use for the tests.</p>
<p>We use the new URL of the database for tests:</p>
<div class="highlight"><pre><span></span><code>sqlite:///testing.db
</code></pre></div>
<p>And again, we use the connection argument <code>check_same_thread=False</code>.</p>
</li>
<li>
<p>Then we call:</p>
<div class="highlight"><pre><span></span><code><span class="n">SQLDev</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div>
<p>...to make sure we create all the tables in the new testing database.</p>
<p>The <strong>table models</strong> are registered in <code>SQLDev.metadata</code> just because we imported <em>something</em> from <code>.main</code>, and the code in <code>.main</code> was executed, creating the classes for the <strong>table models</strong> and automatically registering them in <code>SQLDev.metadata</code>.</p>
<p>So, by the point we call this method, the <strong>table models</strong> are already registered there. 💯</p>
</li>
<li>
<p>Here's where we create the custom <strong>session</strong> object for this test in a <code>with</code> block.</p>
<p>It uses the new custom <strong>engine</strong> we created, so anything that uses this session will be using the testing database.</p>
</li>
<li>
<p>Now, back to the dependency override, it is just returning the same <strong>session</strong> object from outside, that's it, that's the whole trick.</p>
</li>
<li>
<p>By this point, the testing <strong>session</strong> <code>with</code> block finishes, and the session is closed, the file is closed, etc.</p>
</li>
</ol>
<h3 id="import-table-models">Import Table Models<a class="headerlink" href="#import-table-models" title="Permanent link">&para;</a></h3>
<p>Here we create all the tables in the testing database with:</p>
<div class="highlight"><pre><span></span><code><span class="n">SQLDev</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div>
<p>But remember that <a class="internal-link" href="../../create-db-and-table/#sqldev-metadata-order-matters" target="_blank">Order Matters</a> and we need to make sure all the <strong>SQLDev</strong> models are already defined and <strong>imported</strong> before calling <code>.create_all()</code>.</p>
<p>In this case, it all works for a little subtlety that deserves some attention.</p>
<p>Because we import something, <em>anything</em>, from <code>.main</code>, the code in <code>.main</code> will be executed, including the definition of the <strong>table models</strong>, and that will automatically register them in <code>SQLDev.metadata</code>.</p>
<p>That way, when we call <code>.create_all()</code> all the <strong>table models</strong> are correctly registered in <code>SQLDev.metadata</code> and it will all work. 👌</p>
<h2 id="memory-database">Memory Database<a class="headerlink" href="#memory-database" title="Permanent link">&para;</a></h2>
<p>Now we are not using the production database. Instead, we use a <strong>new testing database</strong> with the <code>testing.db</code> file, which is great.</p>
<p>But SQLite also supports having an <strong>in memory</strong> database. This means that all the database is only in memory, and it is never saved in a file on disk.</p>
<p>After the program terminates, <strong>the in-memory database is deleted</strong>, so it wouldn't help much for a production database.</p>
<p>But <strong>it works great for testing</strong>, because it can be quickly created before each test, and quickly removed after each test. ✅</p>
<p>And also, because it never has to write anything to a file and it's all just in memory, it will be even faster than normally. 🏎</p>
<details>
<summary>Other alternatives and ideas 👀</summary>
<p>Before arriving at the idea of using an <strong>in-memory database</strong> we could have explored other alternatives and ideas.</p>
<p>The first is that we are not deleting the file after we finish the test, so the next test could have <strong>leftover data</strong>. So, the right thing would be to delete the file right after finishing the test. 🔥</p>
<p>But if each test has to create a new file and then delete it afterwards, running all the tests could be <strong>a bit slow</strong>.</p>
<p>Right now, we have a file <code>testing.db</code> that is used by all the tests (we only have one test now, but we will have more).</p>
<p>So, if we tried to run the tests at the same time <strong>in parallel</strong> to try to speed things up a bit, they would clash trying to use the <em>same</em> <code>testing.db</code> file.</p>
<p>Of course, we could also fix that, using some <strong>random name</strong> for each testing database file... but in the case of SQLite, we have an even better alternative by just using an <strong>in-memory database</strong>. ✨</p>
</details>
<h2 id="configure-the-in-memory-database">Configure the In-Memory Database<a class="headerlink" href="#configure-the-in-memory-database" title="Permanent link">&para;</a></h2>
<p>Let's update our code to use the in-memory database.</p>
<p>We just have to change a couple of parameters in the <strong>engine</strong>.</p>
<div class="annotate highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">readyapi.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span> <span class="nn">sqldev</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">SQLDev</span><span class="p">,</span> <span class="n">create_engine</span>
<span class="hll"><span class="kn">from</span> <span class="nn">sqldev.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>  <span class="c1"># (1)!</span>
</span>
<span class="kn">from</span> <span class="nn">.main</span> <span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">get_session</span>


<span class="k">def</span> <span class="nf">test_create_hero</span><span class="p">():</span>
<span class="hll">    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
</span><span class="hll">        <span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span>  <span class="c1"># (2)!</span>
</span><span class="hll">        <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;check_same_thread&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
</span><span class="hll">        <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span><span class="p">,</span>  <span class="c1"># (3)!</span>
</span><span class="hll">    <span class="p">)</span>
</span>
<span class="c1"># Code below omitted 👇</span>
</code></pre></div>
<ol>
<li>
<p>Import <code>StaticPool</code> from <code>sqldev</code>, we will use it in a bit.</p>
</li>
<li>
<p>For the <strong>SQLite URL</strong>, don't write any file name, leave it empty.</p>
<p>So, instead of:</p>
<div class="highlight"><pre><span></span><code>sqlite:///testing.db
</code></pre></div>
<p>...just write:</p>
<div class="highlight"><pre><span></span><code>sqlite://
</code></pre></div>
<p>This is enough to tell <strong>SQLDev</strong> (actually SQLAlchemy) that we want to use an <strong>in-memory SQLite database</strong>.</p>
</li>
<li>
<p>Remember that we told the <strong>low-level</strong> library in charge of communicating with SQLite that we want to be able to <strong>access the database from different threads</strong> with <code>check_same_thread=False</code>?</p>
<p>Now that we use an <strong>in-memory database</strong>, we need to also tell SQLAlchemy that we want to be able to use the <strong>same in-memory database</strong> object from different threads.</p>
<p>We tell it that with the <code>poolclass=StaticPool</code> parameter.</p>
<p>!!! info
    You can read more details in the <a href="https://docs.sqlalchemy.org/en/14/dialects/sqlite.html#using-a-memory-database-in-multiple-threads" class="external-link" target="_blank">SQLAlchemy documentation about Using a Memory Database in Multiple Threads</a></p>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Check out the number bubbles to see what is done by each line of code.</p>
</div>
<p>That's it, now the test will run using the <strong>in-memory database</strong>, which will be faster and probably safer.</p>
<p>And all the other tests can do the same.</p>
<h2 id="boilerplate-code">Boilerplate Code<a class="headerlink" href="#boilerplate-code" title="Permanent link">&para;</a></h2>
<p>Great, that works, and you could replicate all that process in each of the test functions.</p>
<p>But we had to add a lot of <strong>boilerplate code</strong> to handle the custom database, creating it in memory, the custom session, and the dependency override.</p>
<p>Do we really have to duplicate all that for <strong>each test</strong>? No, we can do better! 😎</p>
<p>We are using <strong>pytest</strong> to run the tests. And pytest also has a very similar concept to the <strong>dependencies in ReadyAPI</strong>.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>In fact, pytest was one of the things that inspired the design of the dependencies in ReadyAPI.</p>
</div>
<p>It's a way for us to declare some <strong>code that should be run before</strong> each test and <strong>provide a value</strong> for the test function (that's pretty much the same as ReadyAPI dependencies).</p>
<p>In fact, it also has the same trick of allowing to use <code>yield</code> instead of <code>return</code> to provide the value, and then <strong>pytest</strong> makes sure that the code after <code>yield</code> is executed <em>after</em> the function with the test is done.</p>
<p>In pytest, these things are called <strong>fixtures</strong> instead of <em>dependencies</em>.</p>
<p>Let's use these <strong>fixtures</strong> to improve our code and reduce de duplicated boilerplate for the next tests.</p>
<h2 id="pytest-fixtures">Pytest Fixtures<a class="headerlink" href="#pytest-fixtures" title="Permanent link">&para;</a></h2>
<p>You can read more about them in the <a href="https://docs.pytest.org/en/6.2.x/fixture.html" class="external-link" target="_blank">pytest docs for fixtures</a>, but I'll give you a short example for what we need here.</p>
<p>Let's see the first code example with a fixture:</p>
<div class="annotate highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>  <span class="c1"># (1)!</span>
<span class="kn">from</span> <span class="nn">readyapi.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span> <span class="nn">sqldev</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">SQLDev</span><span class="p">,</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqldev.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>

<span class="kn">from</span> <span class="nn">.main</span> <span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">get_session</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>  <span class="c1"># (2)!</span>
<span class="k">def</span> <span class="nf">session_fixture</span><span class="p">():</span>  <span class="c1"># (3)!</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
        <span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;check_same_thread&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span>
    <span class="p">)</span>
    <span class="n">SQLDev</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>  <span class="c1"># (4)!</span>


<span class="k">def</span> <span class="nf">test_create_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">):</span>  <span class="c1"># (5)!</span>
    <span class="k">def</span> <span class="nf">get_session_override</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">session</span>  <span class="c1"># (6)!</span>

    <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="p">[</span><span class="n">get_session</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_session_override</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Nx Pkg&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpond&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>
<ol>
<li>
<p>Import <code>pytest</code>.</p>
</li>
<li>
<p>Use the <code>@pytest.fixture()</code> decorator on top of the function to tell pytest that this is a <strong>fixture</strong> function (equivalent to a ReadyAPI dependency).</p>
<p>We also give it a name of <code>"session"</code>, this will be important in the testing function.</p>
</li>
<li>
<p>Create the fixture function. This is equivalent to a ReadyAPI dependency function.</p>
<p>In this fixture we create the custom <strong>engine</strong>, with the in-memory database, we create the tables, and we create the <strong>session</strong>.</p>
<p>Then we <code>yield</code> the <code>session</code> object.</p>
</li>
<li>
<p>The thing that we <code>return</code> or <code>yield</code> is what will be available to the test function, in this case, the <code>session</code> object.</p>
<p>Here we use <code>yield</code> so that <strong>pytest</strong> comes back to execute "the rest of the code" in this function once the testing function is done.</p>
<p>We don't have any more visible "rest of the code" after the <code>yield</code>, but we have the end of the <code>with</code> block that will close the <strong>session</strong>.</p>
<p>By using <code>yield</code>, pytest will:</p>
<ul>
<li>run the first part</li>
<li>create the <strong>session</strong> object</li>
<li>give it to the test function</li>
<li>run the test function</li>
<li>once the test function is done, it will continue here, right after the <code>yield</code>, and will correctly close the <strong>session</strong> object in the end of the <code>with</code> block.</li>
</ul>
</li>
<li>
<p>Now, in the test function, to tell <strong>pytest</strong> that this test wants to get the fixture, instead of declaring something like in ReadyAPI with:</p>
<div class="highlight"><pre><span></span><code><span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">session_fixture</span><span class="p">)</span>
</code></pre></div>
<p>...the way we tell pytest what is the fixture that we want is by using the <strong>exact same name</strong> of the fixture.</p>
<p>In this case, we named it <code>session</code>, so the parameter has to be exactly named <code>session</code> for it to work.</p>
<p>We also add the type annotation <code>session: Session</code> so that we can get autocompletion and inline error checks in our editor.</p>
</li>
<li>
<p>Now in the dependency override function, we just return the same <code>session</code> object that came from outside it.</p>
<p>The <code>session</code> object comes from the parameter passed to the test function, and we just re-use it and return it here in the dependency override.</p>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Check out the number bubbles to see what is done by each line of code.</p>
</div>
<p><strong>pytest</strong> fixtures work in a very similar way to ReadyAPI dependencies, but have some minor differences:</p>
<ul>
<li>In pytest fixtures, we need to add a decorator of <code>@pytest.fixture()</code> on top.</li>
<li>To use a pytest fixture in a function, we have to declare the parameter with the <strong>exact same name</strong>. In ReadyAPI we have to <strong>explicitly use <code>Depends()</code></strong> with the actual function inside it.</li>
</ul>
<p>But apart from the way we declare them and how we tell the framework that we want to have them in the function, they <strong>work in a very similar way</strong>.</p>
<p>Now we create lot's of tests and re-use that same fixture in all of them, saving us that <strong>boilerplate code</strong>.</p>
<p><strong>pytest</strong> will make sure to run them right before (and finish them right after) each test function. So, each test function will actually have its own database, engine, and session.</p>
<h2 id="client-fixture">Client Fixture<a class="headerlink" href="#client-fixture" title="Permanent link">&para;</a></h2>
<p>Awesome, that fixture helps us prevent a lot of duplicated code.</p>
<p>But currently, we still have to write some code in the test function that will be repetitive for other tests, right now we:</p>
<ul>
<li>create the <strong>dependency override</strong></li>
<li>put it in the <code>app.dependency_overrides</code></li>
<li>create the <code>TestClient</code></li>
<li>Clear the dependency override(s) after making the request</li>
</ul>
<p>That's still gonna be repetitive in the other future tests. Can we improve it? Yes! 🎉</p>
<p>Each <strong>pytest</strong> fixture (the same way as <strong>ReadyAPI</strong> dependencies), can require other fixtures.</p>
<p>So, we can create a <strong>client fixture</strong> that will be used in all the tests, and it will itself require the <strong>session fixture</strong>.</p>
<div class="annotate highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">readyapi.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span> <span class="nn">sqldev</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">SQLDev</span><span class="p">,</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqldev.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>

<span class="kn">from</span> <span class="nn">.main</span> <span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">get_session</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">session_fixture</span><span class="p">():</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
        <span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;check_same_thread&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span>
    <span class="p">)</span>
    <span class="n">SQLDev</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>


<span class="hll"><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;client&quot;</span><span class="p">)</span>  <span class="c1"># (1)!</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">client_fixture</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">):</span>  <span class="c1"># (2)!</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">get_session_override</span><span class="p">():</span>  <span class="c1"># (3)!</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">session</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="p">[</span><span class="n">get_session</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_session_override</span>  <span class="c1"># (4)!</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>  <span class="c1"># (5)!</span>
</span><span class="hll">    <span class="k">yield</span> <span class="n">client</span>  <span class="c1"># (6)!</span>
</span><span class="hll">    <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># (7)!</span>
</span>

<span class="hll"><span class="k">def</span> <span class="nf">test_create_hero</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>  <span class="c1"># (8)!</span>
</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Nx Pkg&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpond&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>
<ol>
<li>
<p>Create the new fixture named <code>"client"</code>.</p>
</li>
<li>
<p>This <strong>client fixture</strong>, in turn, also requires the <strong>session fixture</strong>.</p>
</li>
<li>
<p>Now we create the <strong>dependency override</strong> inside the client fixture.</p>
</li>
<li>
<p>Set the <strong>dependency override</strong> in the <code>app.dependency_overrides</code> dictionary.</p>
</li>
<li>
<p>Create the <code>TestClient</code> with the <strong>ReadyAPI</strong> <code>app</code>.</p>
</li>
<li>
<p><code>yield</code> the <code>TestClient</code> instance.</p>
<p>By using <code>yield</code>, after the test function is done, pytest will come back to execute the rest of the code after <code>yield</code>.</p>
</li>
<li>
<p>This is the cleanup code, after <code>yield</code>, and after the test function is done.</p>
<p>Here we clear the dependency overrides (here it's only one) in the ReadyAPI <code>app</code>.</p>
</li>
<li>
<p>Now the test function requires the <strong>client fixture</strong>.</p>
<p>And inside the test function, the code is quite <strong>simple</strong>, we just use the <code>TestClient</code> to make requests to the API, check the data, and that's it.</p>
<p>The fixtures take care of all the <strong>setup</strong> and <strong>cleanup</strong> code.</p>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Check out the number bubbles to see what is done by each line of code.</p>
</div>
<p>Now we have a <strong>client fixture</strong> that, in turn, uses the <strong>session fixture</strong>.</p>
<p>And in the actual test function, we just have to declare that we require this <strong>client fixture</strong>.</p>
<h2 id="add-more-tests">Add More Tests<a class="headerlink" href="#add-more-tests" title="Permanent link">&para;</a></h2>
<p>At this point, it all might seem like we just did a lot of changes for nothing, to get <strong>the same result</strong>. 🤔</p>
<p>But normally we will create <strong>lots of other test functions</strong>. And now all the boilerplate and complexity is <strong>written only once</strong>, in those two fixtures.</p>
<p>Let's add some more tests:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Code above omitted 👆</span>

<span class="hll"><span class="k">def</span> <span class="nf">test_create_hero</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Nx Pkg&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpond&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">test_create_hero_incomplete</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="c1"># No secret_name</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">})</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">422</span>


<span class="hll"><span class="k">def</span> <span class="nf">test_create_hero_invalid</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
</span>    <span class="c1"># secret_name has an invalid type</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span>
            <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Do you wanna know my secret identity?&quot;</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">422</span>

<span class="c1"># Code below omitted 👇</span>
</code></pre></div>
<details>
<summary>👀 Full file preview</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">readyapi.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span> <span class="nn">sqldev</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">SQLDev</span><span class="p">,</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqldev.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>

<span class="kn">from</span> <span class="nn">.main</span> <span class="kn">import</span> <span class="n">Hero</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">get_session</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">session_fixture</span><span class="p">():</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
        <span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;check_same_thread&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span>
    <span class="p">)</span>
    <span class="n">SQLDev</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;client&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">client_fixture</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_session_override</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">session</span>

    <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="p">[</span><span class="n">get_session</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_session_override</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">client</span>
    <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_create_hero</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Nx Pkg&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpond&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">test_create_hero_incomplete</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="c1"># No secret_name</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">})</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">422</span>


<span class="k">def</span> <span class="nf">test_create_hero_invalid</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="c1"># secret_name has an invalid type</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span>
            <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Do you wanna know my secret identity?&quot;</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">422</span>


<span class="k">def</span> <span class="nf">test_read_heroes</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">hero_2</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Rusty-Man&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Tommy Sharp&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">48</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_2</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/heroes/&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">secret_name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">secret_name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">id</span>


<span class="k">def</span> <span class="nf">test_read_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/heroes/</span><span class="si">{</span><span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">secret_name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span>


<span class="k">def</span> <span class="nf">test_update_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/heroes/</span><span class="si">{</span><span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpuddle&quot;</span><span class="p">})</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpuddle&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span>


<span class="k">def</span> <span class="nf">test_delete_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/heroes/</span><span class="si">{</span><span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">hero_in_db</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Hero</span><span class="p">,</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

    <span class="k">assert</span> <span class="n">hero_in_db</span> <span class="ow">is</span> <span class="kc">None</span>
</code></pre></div>
</details>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It's always <strong>good idea</strong> to not only test the normal case, but also that <strong>invalid data</strong>, <strong>errors</strong>, and <strong>corner cases</strong> are handled correctly.</p>
<p>That's why we add these two extra tests here.</p>
</div>
<p>Now, any additional test functions can be as <strong>simple</strong> as the first one, they just have to <strong>declare the <code>client</code> parameter</strong> to get the <code>TestClient</code> <strong>fixture</strong> with all the database stuff setup. Nice! 😎</p>
<h2 id="why-two-fixtures">Why Two Fixtures<a class="headerlink" href="#why-two-fixtures" title="Permanent link">&para;</a></h2>
<p>Now, seeing the code, we could think, why do we put <strong>two fixtures</strong> instead of <strong>just one</strong> with all the code? And that makes total sense!</p>
<p>For these examples, <strong>that would have been simpler</strong>, there's no need to separate that code into two fixtures for them...</p>
<p>But for the next test function, we will require <strong>both fixtures</strong>, the <strong>client</strong> and the <strong>session</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">readyapi.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span> <span class="nn">sqldev</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">SQLDev</span><span class="p">,</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqldev.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>

<span class="hll"><span class="kn">from</span> <span class="nn">.main</span> <span class="kn">import</span> <span class="n">Hero</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">get_session</span>
</span>
<span class="c1"># Code here omitted 👈</span>

<span class="hll"><span class="k">def</span> <span class="nf">test_read_heroes</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
</span>    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">hero_2</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Rusty-Man&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Tommy Sharp&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">48</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_2</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/heroes/&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">secret_name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">secret_name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">id</span>

<span class="c1"># Code below omitted 👇</span>
</code></pre></div>
<details>
<summary>👀 Full file preview</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">readyapi.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span> <span class="nn">sqldev</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">SQLDev</span><span class="p">,</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqldev.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>

<span class="kn">from</span> <span class="nn">.main</span> <span class="kn">import</span> <span class="n">Hero</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">get_session</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">session_fixture</span><span class="p">():</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
        <span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;check_same_thread&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span>
    <span class="p">)</span>
    <span class="n">SQLDev</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;client&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">client_fixture</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_session_override</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">session</span>

    <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="p">[</span><span class="n">get_session</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_session_override</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">client</span>
    <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_create_hero</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Nx Pkg&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpond&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">test_create_hero_incomplete</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="c1"># No secret_name</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">})</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">422</span>


<span class="k">def</span> <span class="nf">test_create_hero_invalid</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="c1"># secret_name has an invalid type</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span>
            <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Do you wanna know my secret identity?&quot;</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">422</span>


<span class="k">def</span> <span class="nf">test_read_heroes</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">hero_2</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Rusty-Man&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Tommy Sharp&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">48</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_2</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/heroes/&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">secret_name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">secret_name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">id</span>


<span class="k">def</span> <span class="nf">test_read_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/heroes/</span><span class="si">{</span><span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">secret_name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span>


<span class="k">def</span> <span class="nf">test_update_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/heroes/</span><span class="si">{</span><span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpuddle&quot;</span><span class="p">})</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpuddle&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span>


<span class="k">def</span> <span class="nf">test_delete_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/heroes/</span><span class="si">{</span><span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">hero_in_db</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Hero</span><span class="p">,</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

    <span class="k">assert</span> <span class="n">hero_in_db</span> <span class="ow">is</span> <span class="kc">None</span>
</code></pre></div>
</details>
<p>In this test function, we want to check that the <em>path operation</em> to <strong>read a list of heroes</strong> actually sends us heroes.</p>
<p>But if the <strong>database is empty</strong>, we would get an <strong>empty list</strong>, and we wouldn't know if the hero data is being sent correctly or not.</p>
<p>But we can <strong>create some heroes</strong> in the testing database right before sending the API request. ✨</p>
<p>And because we are using the <strong>testing database</strong>, we don't affect anything by creating heroes for the test.</p>
<p>To do it, we have to:</p>
<ul>
<li>import the <code>Hero</code> model</li>
<li>require both fixtures, the <strong>client</strong> and the <strong>session</strong></li>
<li>create some heroes and save them in the database using the <strong>session</strong></li>
</ul>
<p>After that, we can send the request and check that we actually got the data back correctly from the database. 💯</p>
<p>Here's the important detail to notice: we can require fixtures in other fixtures <strong>and also</strong> in the test functions.</p>
<p>The function for the <strong>client fixture</strong> and the actual testing function will <strong>both</strong> receive the same <strong>session</strong>.</p>
<h2 id="add-the-rest-of-the-tests">Add the Rest of the Tests<a class="headerlink" href="#add-the-rest-of-the-tests" title="Permanent link">&para;</a></h2>
<p>Using the same ideas, requiring the fixtures, creating data that we need for the tests, etc., we can now add the rest of the tests. They look quite similar to what we have done up to now.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Code above omitted 👆</span>

<span class="hll"><span class="k">def</span> <span class="nf">test_read_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
</span>    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/heroes/</span><span class="si">{</span><span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">secret_name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span>


<span class="hll"><span class="k">def</span> <span class="nf">test_update_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
</span>    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/heroes/</span><span class="si">{</span><span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpuddle&quot;</span><span class="p">})</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpuddle&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span>


<span class="hll"><span class="k">def</span> <span class="nf">test_delete_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
</span>    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/heroes/</span><span class="si">{</span><span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">hero_in_db</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Hero</span><span class="p">,</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

    <span class="k">assert</span> <span class="n">hero_in_db</span> <span class="ow">is</span> <span class="kc">None</span>
</code></pre></div>
<details>
<summary>👀 Full file preview</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">readyapi.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span> <span class="nn">sqldev</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">SQLDev</span><span class="p">,</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqldev.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>

<span class="kn">from</span> <span class="nn">.main</span> <span class="kn">import</span> <span class="n">Hero</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">get_session</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">session_fixture</span><span class="p">():</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
        <span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;check_same_thread&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span>
    <span class="p">)</span>
    <span class="n">SQLDev</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;client&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">client_fixture</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_session_override</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">session</span>

    <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="p">[</span><span class="n">get_session</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_session_override</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">client</span>
    <span class="n">app</span><span class="o">.</span><span class="n">dependency_overrides</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_create_hero</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Nx Pkg&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpond&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">test_create_hero_incomplete</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="c1"># No secret_name</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">})</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">422</span>


<span class="k">def</span> <span class="nf">test_create_hero_invalid</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="c1"># secret_name has an invalid type</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/heroes/&quot;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span>
            <span class="s2">&quot;secret_name&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Do you wanna know my secret identity?&quot;</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">422</span>


<span class="k">def</span> <span class="nf">test_read_heroes</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">hero_2</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Rusty-Man&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Tommy Sharp&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">48</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_2</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/heroes/&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">secret_name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">secret_name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_2</span><span class="o">.</span><span class="n">id</span>


<span class="k">def</span> <span class="nf">test_read_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/heroes/</span><span class="si">{</span><span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">secret_name</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span>


<span class="k">def</span> <span class="nf">test_update_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/heroes/</span><span class="si">{</span><span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadpuddle&quot;</span><span class="p">})</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Deadpuddle&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secret_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Nx Pkg&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span>


<span class="k">def</span> <span class="nf">test_delete_hero</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">TestClient</span><span class="p">):</span>
    <span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Nx Pkg&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/heroes/</span><span class="si">{</span><span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">hero_in_db</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Hero</span><span class="p">,</span> <span class="n">hero_1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

    <span class="k">assert</span> <span class="n">hero_in_db</span> <span class="ow">is</span> <span class="kc">None</span>
</code></pre></div>
</details>
<h2 id="run-the-tests">Run the Tests<a class="headerlink" href="#run-the-tests" title="Permanent link">&para;</a></h2>
<p>Now we can run the tests with <code>pytest</code> and see the results:</p>
<div class="termy">

<div class="highlight"><pre><span></span><code><span class="gp">$ </span>pytest

<span class="go">============= test session starts ==============</span>
<span class="go">platform linux -- Python 3.7.5, pytest-6.2.4, py-1.10.0, pluggy-0.13.1</span>
<span class="go">rootdir: /home/user/code/sqldev-tutorial</span>
<span class="go">&lt;b&gt;collected 7 items                              &lt;/b&gt;</span>

<span class="go">---&gt; 100%</span>

<span class="go">project/test_main.py &lt;font color=&quot;#A6E22E&quot;&gt;.......         [100%]&lt;/font&gt;</span>

<span class="go">&lt;font color=&quot;#A6E22E&quot;&gt;============== &lt;/font&gt;&lt;font color=&quot;#A6E22E&quot;&gt;&lt;b&gt;7 passed&lt;/b&gt;&lt;/font&gt;&lt;font color=&quot;#A6E22E&quot;&gt; in 0.83s ===============&lt;/font&gt;</span>
</code></pre></div>

</div>

<h2 id="recap">Recap<a class="headerlink" href="#recap" title="Permanent link">&para;</a></h2>
<p>Did you read all that? Wow, I'm impressed! 😎</p>
<p>Adding tests to your application will give you a lot of <strong>certainty</strong> that everything is <strong>working correctly</strong>, as you intended.</p>
<p>And tests will be notoriously useful when <strong>refactoring</strong> your code, <strong>changing things</strong>, <strong>adding features</strong>. Because tests can help catch a lot of errors that can be easily introduced by refactoring.</p>
<p>And they will give you the confidence to work faster and <strong>more efficiently</strong>, because you know that you are checking if you are <strong>not breaking anything</strong>. 😅</p>
<p>I think tests are one of those things that bring your code and you as a developer to the next professional level. 😎</p>
<p>And if you read and studied all this, you already know a lot of the advanced ideas and tricks that took me years to learn. 🚀</p>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/khulnasoft/sqldev" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/khulnasoft" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/khulnasoft" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://dev.to/khulnasoft" target="_blank" rel="noopener" title="dev.to" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://medium.com/@khulnasoft" target="_blank" rel="noopener" title="medium.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M180.5 74.262C80.813 74.262 0 155.633 0 256s80.819 181.738 180.5 181.738S361 356.373 361 256 280.191 74.262 180.5 74.262Zm288.25 10.646c-49.845 0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559c0-94.503-40.4-171.095-90.248-171.095Zm139.506 17.821c-17.526 0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://khulnasoft.com" target="_blank" rel="noopener" title="khulnasoft.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.3c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64h185.4c2.2 20.4 3.3 41.8 3.3 64zm28.8-64h123.1c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64zm112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6 78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7 10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5 11.6 26 20.9 58.2 27 94.7zm-209 0H18.6c30-74.1 93.6-130.9 172-151.6-25.5 34.2-45.3 87.7-55.3 151.6zM8.1 192h123.1c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64zm186.6 254.6c-11.6-26-20.9-58.2-27-94.6h176.6c-6.1 36.4-15.5 68.6-27 94.6-10.5 23.6-22.2 40.7-33.5 51.5-11.2 10.7-20.5 13.9-27.8 13.9s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6-78.4-20.7-142-77.5-172-151.6h116.7zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6 25.5-34.2 45.2-87.7 55.3-151.6h116.6z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["search.suggest", "search.highlight", "content.tabs.link", "navigation.indexes", "content.tooltips", "navigation.path", "content.code.annotate", "content.code.copy", "content.code.select"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
        <script src="../../../js/termynal.js"></script>
      
        <script src="../../../js/custom.js"></script>
      
    
  </body>
</html>